name: Run MCV Script Daily

on:
  # 1. スケジュール実行 (日本時間の朝7時〜夜24時まで1時間おき)
  # GitHubはUTC(世界協定時)基準なので、JST-9時間で設定する必要があります。
  # 例: JST 6:00 -> UTC 21:00 (前日)
  # 以下の設定は「毎時0分」に実行します
  schedule:
    - cron: '0 * * * *' 

  # 2. 手動実行 (テスト用ボタンを表示)
  workflow_dispatch:

jobs:
  run-mcv-scraper:
    runs-on: ubuntu-latest
    
    # タイムアウト設定（万が一ブラウザが固まった場合、10分で強制終了）
    timeout-minutes: 10

    steps:
      # 1. リポジトリのコードを取得
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Pythonのセットアップ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          cache: 'pip' # ライブラリのキャッシュを有効化

      # 3. ライブラリのインストール
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. スクリプトの実行
      - name: Run script
        env:
          # ここでGitHub Secretsの値を環境変数としてスクリプトに渡します
          USER_ID: ${{ secrets.USER_ID }}
          USER_PASS: ${{ secrets.USER_PASS }}
          GCP_JSON: ${{ secrets.GCP_JSON }}
        run: python mcv_main.py
